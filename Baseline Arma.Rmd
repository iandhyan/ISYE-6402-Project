
# UNIVARIATE ARMA MODEL - TOTAL SALES


library(readr)
library(lubridate)
library(forecast)
library(ggplot2)
library(gridExtra)

# ---- Load Data ----
veh <- read_csv("/Users/niraj/Downloads/VehicleData-1 (1).csv")
veh$DATE <- mdy(veh$DATE)
veh <- veh[order(veh$DATE), ]

# Create time series
sales_ts <- ts(
  veh$`Total Sales`,
  start = c(2000, 1),
  frequency = 12
)


# 1. Stationarity Check via Differencing

sales_diff <- diff(sales_ts)

autoplot(sales_diff) +
  ggtitle("Differenced Total Sales (Stationary Input for ARMA)") +
  theme_minimal()

# 2. ACF/PACF for ARMA Order Selection

acf_sales  <- ggAcf(sales_diff)  + ggtitle("ACF - Differenced Total Sales")
pacf_sales <- ggPacf(sales_diff) + ggtitle("PACF - Differenced Total Sales")

grid.arrange(acf_sales, pacf_sales, ncol=2)


# 3. Fit ARMA(p,q) Model with auto.arima()

arma_sales <- auto.arima(
  sales_ts,
  d = 1,              # ensures ARMA model with differenced input
  seasonal = FALSE,  # ARMA, NOT ARIMA/SARIMA
  stepwise = FALSE,
  approximation = FALSE
)

summary(arma_sales)


# 4. Forecast Next 12 Months

fc_sales <- forecast(arma_sales, h = 12)

autoplot(fc_sales) +
  ggtitle("ARMA Forecast - Total Sales") +
  xlab("Date") + ylab("Total Sales")
